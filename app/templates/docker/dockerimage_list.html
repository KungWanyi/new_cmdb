{% extends "base.html" %}
{% import "page.html" as page %}
{% block header_css %}
    <link href="{{ url_for('static',filename='css/ladda-themeless.min.css') }}" rel="stylesheet" />
{% endblock %}
{% block content %}
    <div id="page-wrapper" class="list">
        <div id="page-inner">
            <div class="row">
                <div class="col-md-12">
                    <h4 class="page-header">
                       <i class="fa fa-home"></i> Docker管理 > Docker镜像管理
                    </h4>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Docker镜像列表
                        </div>
                        <div class="panel-body">
                            <form method="post" action="{{url_for('docker.dockerimage_list')}}">
                                <div class="col-md-4 pull-right" style="margin-right:-15px;margin-bottom:5px">
                                    <div class="input-group">
                                        <input type="text" name="search" class="form-control" placeholder="搜索" v-model="search"/>
                                        <span class="input-group-btn">
                                           <input type="submit" onclick="return check_search()" class="btn btn-info btn-search" value="搜索">
                                        </span>
                                    </div>
                                </div>
                            </form>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered table-hover">
                                    <thead>
                                        <tr>
                                            <th>编号</th>
                                            <th>镜像名称</th>
                                            <th>镜像ID</th>
                                            <th>使用的Dockerfile</th>
                                            <th>创建人</th>
                                            <th>创建时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for image in dockerimages %}
                                        <tr>
                                            <td>{{image.id}}</td>
                                            <td>{{image.image_name}}:{{image.tag_name}}</td>
                                            <td>{{image.image_id}}</td>
                                            <td>{{image.dockerfile.name | default('-',true)}}</td>
                                            <td>{{image.creater}}</td>
                                            <td>{{image.create_time}}</td>
                                            <td><span class="label label-danger" @click="delete_image('{{image.id}}')">删除</span></td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if pagination %}
                                <div class="pagination" style="float:right">
                                    {{ page.pagination_widget(pagination,"docker.dockerimage_list") }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block bottom_js %}
    <script src="{{ url_for('static',filename='js/spin.min.js') }}"></script>
    <script src="{{ url_for('static',filename='js/ladda.min.js') }}"></script>
    <script>
        window.onload = function(){
            $('#docker_manage').collapse('show');
        };
        data = {
            search:'',
            images:'',
        }
        function check_search(){
            if($.trim(data.search).length == 0){
                return false;
            }
        }
        new Vue({
            el: '.list',
            data: data,
            methods: {
                delete_image: function(image_id){
                    delete_image(image_id);
                }
            }
        })
        function delete_image(image_id){
            $.ajax({
                url:"{{url_for('docker.dockerimage_list')}}",
                data:{'id':image_id},
                timeout:5000,
                type:'post',
                success:function(response){
                    if(response.result == 1){
                        swal({
                            "title": "成功",
                            "text": "删除成功！",
                            "type": "success"
                            }, function () {
                                setTimeout(function () {
                                    window.location.reload();
                            }, 50);
                        })
                    } else {
                        swal("失败",response.errMsg,"error");
                    }
                }
            })    

        }
    </script>
{% endblock %}
